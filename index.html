<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</title>
  <style>
    body { font-family: sans-serif; padding: 20px; transition: background 0.3s, color 0.3s; }
    .thread { padding: 10px; border-bottom: 1px solid #ccc; margin: 6px 0; }
    .dark { background: #111; color: #f5f5f5; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>
</head>
<body>

<h1>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</h1>

<button onclick="toggleMode()">ğŸŒ™ ãƒ€ãƒ¼ã‚¯ / ãƒ©ã‚¤ãƒˆ</button>
<hr>

<h2>ğŸ€ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
åå‰ <input id="profileName"><br>
ã²ã¨ã“ã¨ <input id="profileComment"><br>
ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒURL <input id="profileIcon"><br>
<button onclick="saveProfile()">ä¿å­˜</button>
<hr>

<h2>ğŸ“Œ æ–°è¦ã‚¹ãƒ¬ä½œæˆ</h2>
<input id="threadTitle" placeholder="ã‚¹ãƒ¬ã®åå‰">
<button onclick="createThread()">ä½œæˆ</button>
<hr>

<h2>ğŸ“š ã‚¹ãƒ¬ä¸€è¦§</h2>
<div id="threadList"></div>

<script>
/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  authDomain: "keijiban-7c651.firebaseapp.com",
  databaseURL: "https://keijiban-7c651-default-rtdb.firebaseio.com",
  projectId: "keijiban-7c651",
  storageBucket: "keijiban-7c651.firebasestorage.app",
  messagingSenderId: "342192640264",
  appId: "1:342192640264:web:a004a725b470741aaf1cbd",
  measurementId: "G-7E1BZ3BGBR"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ID */
let userId = localStorage.getItem("userId");
if (!userId) {
  userId = "user_" + Math.random().toString(36).substring(2);
  localStorage.setItem("userId", userId);
}

/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« */
const profileRef = db.ref("profiles");
const defaultIcon = "usagi.png.jpeg";

profileRef.child(userId).get().then(snap => {
  const p = snap.val();
  if (p) {
    profileName.value = p.name;
    profileComment.value = p.comment;
    profileIcon.value = p.icon;
  } else {
    profileIcon.value = defaultIcon;
  }
});

function saveProfile() {
  profileRef.child(userId).set({
    name: profileName.value,
    comment: profileComment.value,
    icon: profileIcon.value || defaultIcon
  });
  alert("ä¿å­˜ã—ãŸã‚ˆğŸ°");
}

/* ã‚¹ãƒ¬ä½œæˆ */
function createThread() {
  const title = threadTitle.value.trim();
  if (!title) return;
  db.ref("threads").push({ title, owner: userId });
  threadTitle.value = "";
}

/* ã‚¹ãƒ¬ä¸€è¦§è¡¨ç¤º */
function loadThreads() {
  threadList.innerHTML = "";
  db.ref("threads").on("value", snap => {
    threadList.innerHTML = "";
    const data = snap.val();
    for (let id in data) {
      const d = document.createElement("div");
      d.className = "thread";
      d.innerHTML = `<b>${data[id].title}</b>
        <button onclick="openThread('${id}')">é–‹ã</button>`;
      threadList.appendChild(d);
    }
  });
}
loadThreads();

/* åˆ¥ã‚¿ãƒ–ã§ã‚¹ãƒ¬ã‚’é–‹ã */
function openThread(id) {
  localStorage.setItem("lastThread", id);
  window.open(`thread.html?id=${id}`, "_blank");
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
function toggleMode() {
  document.body.classList.toggle("dark");
}
</script>
</body>
</html>
