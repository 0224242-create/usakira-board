<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ â€“ ã‚¹ãƒ¬ä¸€è¦§</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .thread { padding: 10px; border-bottom: 1px solid #ccc; margin: 8px 0; cursor: pointer; }
    .pagination { display: flex; gap: 10px; margin-top: 20px; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ â€“ ã‚¹ãƒ¬ä¸€è¦§</h1>

  <input id="searchBox" placeholder="ğŸ” ã‚¹ãƒ¬ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢" style="width:100%; font-size:18px; padding:6px; margin-bottom:12px;">

  <input id="threadTitle" placeholder="ğŸ“ æ–°ã—ã„ã‚¹ãƒ¬ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" style="width:100%; font-size:18px; padding:6px;">
  <button id="createThreadBtn" style="margin-top:10px;">ğŸŒŸ æ–°è¦ã‚¹ãƒ¬ã‚’ä½œæˆ</button>

  <h2 style="margin-top:30px;">ğŸ“‚ ã‚¹ãƒ¬ä¸€è¦§</h2>
  <div id="threadList"></div>

  <div class="pagination">
    <button id="prevBtn">â—€ å‰ã¸</button>
    <span id="pageNum"></span>
    <button id="nextBtn">æ¬¡ã¸ â–¶</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
      authDomain: "keijiban-7c651.firebaseapp.com",
      databaseURL: "https://keijiban-7c651-default-rtdb.firebaseio.com",
      projectId: "keijiban-7c651",
      storageBucket: "keijiban-7c651.firebasestorage.app",
      messagingSenderId: "342192640264",
      appId: "1:342192640264:web:a004a725b470741aaf1cbd",
      measurementId: "G-7E1BZ3BGBR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ã‚¹ãƒ¬ä½œæˆ
    document.getElementById("createThreadBtn").addEventListener("click", () => {
      const title = document.getElementById("threadTitle").value;
      if (!title) return;
      const newThread = push(ref(db, "threads"));
      set(newThread, {
        title: title,
        createdAt: Date.now()
      });
      document.getElementById("threadTitle").value = "";
    });

    // æ¤œç´¢ & ãƒšãƒ¼ã‚¸ãƒ³ã‚°
    let allThreads = [];
    let currentPage = 1;
    const perPage = 8;

    const renderThreads = () => {
      const search = document.getElementById("searchBox").value.toLowerCase();
      const filtered = allThreads.filter(t => t.title.toLowerCase().includes(search));
      const list = document.getElementById("threadList");
      list.innerHTML = "";

      const start = (currentPage - 1) * perPage;
      const selected = filtered.slice(start, start + perPage);
      selected.forEach(t => {
        const div = document.createElement("div");
        div.className = "thread";
        div.innerText = t.title;
        div.addEventListener("click", () => {
          location.href = `thread.html?id=${t.id}`;
        });
        list.appendChild(div);
      });

      document.getElementById("pageNum").innerText =
        `${currentPage} / ${Math.max(1, Math.ceil(filtered.length / perPage))}`;
    };

    onValue(ref(db, "threads"), (snapshot) => {
      const data = snapshot.val();
      allThreads = [];
      for (const id in data) {
        allThreads.push({ id, title: data[id].title, createdAt: data[id].createdAt });
      }
      allThreads.sort((a, b) => b.createdAt - a.createdAt);
      renderThreads();
    });

    document.getElementById("searchBox").addEventListener("input", () => {
      currentPage = 1;
      renderThreads();
    });

    document.getElementById("prevBtn").addEventListener("click", () => {
      if (currentPage > 1) currentPage--;
      renderThreads();
    });

    document.getElementById("nextBtn").addEventListener("click", () => {
      currentPage++;
      renderThreads();
    });
  </script>
</body>
</html>
