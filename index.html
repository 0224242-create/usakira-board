<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿âœ¨ï¸</title>
<style>
body {
  font-family: sans-serif;
  background: pink;
  background-image:
    radial-gradient(rgba(255,255,255,0.6), rgba(255,182,193,0.2)),
    url("https://www.transparenttextures.com/patterns/diamond-eyes.png");
  padding: 20px;
}
textarea { width: 100%; height: 80px; }
.post {
  padding: 10px;
  margin: 8px 0;
  border-radius: 10px;
  background: rgba(255,255,255,0.8);
  border: 1px solid #f3a6c0;
}
.name { font-weight: bold; color: #d22; }
.icon { font-size: 22px; margin-right: 4px; }
.reaction { margin-left: 10px; cursor: pointer; }
.reaction:hover { opacity: 0.7; }
.banButton { color: red; cursor: pointer; margin-left: 8px; }
.deleteButton { color: blue; cursor: pointer; margin-left: 8px; }
</style>
</head>
<body>

<h1>ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿âœ¨ï¸</h1>

<div id="banWarning" style="display:none;color:red;font-size:18px;font-weight:bold;margin-bottom:12px;">
ğŸš« ã‚ãªãŸã¯ç¾åœ¨BANä¸­ã®ãŸã‚æŠ•ç¨¿ã§ãã¾ã›ã‚“
</div>

<input id="nameInput" placeholder="åå‰ (ç©ºãªã‚‰ åã‚‚ãªãå…)" /><br><br>
<textarea id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea><br>
<button id="postButton">æŠ•ç¨¿</button>

<hr>
<h2>ğŸ§± BANãƒªã‚¹ãƒˆ</h2>
<div id="banList"></div>
<hr>

<div id="posts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import {
  getDatabase, ref, push, set, onChildAdded, onValue, remove
} from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const firebaseConfig = { â˜…ã“ã“ã«ãã®ã¾ã¾å…¥ã‚Œã‚‹â˜… };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ä»®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
let ownerId = localStorage.getItem("ownerId");
if (!ownerId) {
  ownerId = "user_" + Math.random().toString(36).slice(2);
  localStorage.setItem("ownerId", ownerId);
}

// æŠ•ç¨¿ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå›ºå®š ğŸ°ï¼‰
const icon = "ğŸ°";

// BANç¢ºèª
let isBanned = false;
onValue(ref(db, "bans/" + ownerId), (snap) => {
  isBanned = !!snap.val();
  document.getElementById("banWarning").style.display =
    isBanned ? "block" : "none";
  document.getElementById("postButton").disabled = isBanned;
});

// æŠ•ç¨¿
document.getElementById("postButton").onclick = async () => {
  if (isBanned) return;
  const name = document.getElementById("nameInput").value.trim() || "åã‚‚ãªãå…";
  const msg = document.getElementById("messageInput").value.trim();
  if (!msg) return;

  await push(ref(db, "posts"), {
    name, msg, icon, ownerId,
    time: Date.now(),
    reactions: { carrot: 0, spark: 0 }
  });

  document.getElementById("messageInput").value = "";
};

// æŠ•ç¨¿è¡¨ç¤º
onChildAdded(ref(db, "posts"), (snap) => {
  const key = snap.key;
  const p = snap.val();
  const wrap = document.createElement("div");
  wrap.className = "post";
  wrap.id = key;

  wrap.innerHTML = `
    <span class="icon">${p.icon}</span>
    <span class="name">${p.name}</span>ï¼š${p.msg}
    <span class="reaction">ğŸ¥•${p.reactions?.carrot || 0}</span>
    <span class="reaction">âœ¨${p.reactions?.spark || 0}</span>
    ${p.ownerId === ownerId ? `<span class="deleteButton">å‰Šé™¤</span>` : ""}
    <span class="banButton">BAN</span>
  `;
  document.getElementById("posts").prepend(wrap);

  // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  const [rCarrot, rSpark] = wrap.querySelectorAll(".reaction");
  rCarrot.onclick = () => {
    set(ref(db, `posts/${key}/reactions/carrot`), (p.reactions?.carrot || 0) + 1);
  };
  rSpark.onclick = () => {
    set(ref(db, `posts/${key}/reactions/spark`), (p.reactions?.spark || 0) + 1);
  };

  // å‰Šé™¤
  const del = wrap.querySelector(".deleteButton");
  if (del) del.onclick = () => remove(ref(db, "posts/" + key));

  // BAN
  wrap.querySelector(".banButton").onclick = () => {
    set(ref(db, "bans/" + p.ownerId), true);
  };
});

// BANãƒªã‚¹ãƒˆè¡¨ç¤º
onValue(ref(db, "bans"), (snap) => {
  const list = document.getElementById("banList");
  list.innerHTML = "";
  const data = snap.val() || {};
  Object.keys(data).forEach(id => {
    const div = document.createElement("div");
    div.textContent = id;
    const un = document.createElement("button");
    un.textContent = "è§£é™¤";
    un.onclick = () => remove(ref(db, "bans/" + id));
    div.appendChild(un);
    list.appendChild(div);
  });
});
</script>
</body>
</html>
