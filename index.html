<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- ã“ã‚ŒãŒé‡è¦ -->
<style>
body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg,#ffc0cb,#ffb6c1); margin:0; padding:20px;}
h1 { text-align:center; color:#fff; text-shadow:2px 2px #ff69b4; font-size:24px; }

/* æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  */
#commentForm { display:flex; flex-direction:column; margin-bottom:20px; }
#commentForm input,#commentForm textarea,#commentForm button {
  margin:5px 0; padding:10px; border-radius:10px; border:1px solid #ff69b4; outline:none; font-size:16px; width:100%; box-sizing:border-box;
}
#commentForm button { background-color:#ff69b4; color:white; font-weight:bold; cursor:pointer; transition:.3s; }
#commentForm button:hover { background-color:#ff85c1; }

/* æŠ•ç¨¿è¡¨ç¤º */
.post { background: rgba(255,255,255,0.85); border-radius:15px; padding:10px; margin-bottom:10px; display:flex; flex-direction:column; align-items:flex-start; box-shadow:0 0 10px #ffb6c1; position:relative; }
.post img { width:50px; height:50px; border-radius:50%; margin-bottom:5px; border:2px solid #ff69b4; }
.post-content { flex:1; width:100%; }
.post-content .name { font-weight:bold; color:#d148a3; font-size:16px; }
.post-content .time { font-size:12px; color:#888; margin-left:5px; }
.post-number { font-weight:bold; margin-bottom:3px; color:#d148a3; font-size:14px; }
.reactions { margin-top:5px; font-size:14px; }
.reaction-button { cursor:pointer; margin-right:10px; padding:2px 5px; border-radius:5px; border:1px solid #ff69b4; background-color:#ffe4e1; transition:.2s; font-size:14px; }
.reaction-button:hover { background-color:#ffb6c1; }
.delete-button { position:absolute; top:5px; right:5px; cursor:pointer; font-size:12px; color:#d148a3; border:none; background:none; }

/* ã‚¹ãƒãƒ›å‘ã‘èª¿æ•´ */
@media screen and (max-width:600px) {
  h1 { font-size:20px; }
  .post img { width:40px; height:40px; }
  .reaction-button { font-size:12px; padding:2px 4px; }
}
</style>
</head>
<body>

<h1>ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</h1>

<form id="commentForm">
<input type="text" id="name" placeholder="åå‰" value="åã‚‚ãªãå…"/>
<input type="text" id="icon" placeholder="ã‚¢ã‚¤ã‚³ãƒ³URL" value="usagi.png.jpeg"/>
<textarea id="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã“ã†"></textarea>
<button type="submit">æŠ•ç¨¿</button>
</form>

<div id="posts"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // â˜…Firebaseè¨­å®šï¼ˆè‡ªåˆ†ã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªæƒ…å ±ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰â˜…
  const firebaseConfig = {
    apiKey: "ã“ã“ã«Firebaseã®apiKey",
    authDomain: "keijiban-7c651.firebaseapp.com",
    databaseURL: "https://keijiban-7c651-default-rtdb.firebaseio.com/",
    projectId: "keijiban-7c651",
    storageBucket: "keijiban-7c651.appspot.com",
    messagingSenderId: "ã“ã“ã«Firebaseã®messagingSenderId",
    appId: "ã“ã“ã«Firebaseã®appId"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const postsDiv = document.getElementById("posts");
  const form = document.getElementById("commentForm");

  function linkify(text) {
    const urlPattern = /(https?:\/\/[^\s]+)/g;
    return text.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
  }

  function renderPosts(data){
    postsDiv.innerHTML = "";
    const posts = data ? Object.values(data) : [];
    posts.forEach((p,index)=>{
      if(!p.reactions) p.reactions={carrot:0,spark:0};
      const div=document.createElement("div");
      div.className="post";
      const commentHtml = linkify(p.comment + " ãƒšã‚³");
      div.innerHTML=`
        <div class="post-number">${index+1}</div>
        <img src="${p.icon}" alt="ã‚¢ã‚¤ã‚³ãƒ³">
        <div class="post-content">
          <span class="name">${p.name}</span>
          <span class="time">${p.time}</span>
          <div class="comment-text">${commentHtml}</div>
          <div class="reactions">
            <span class="reaction-button" data-type="carrot">ğŸ¥• ${p.reactions.carrot}</span>
            <span class="reaction-button" data-type="spark">âœ¨ ${p.reactions.spark}</span>
          </div>
        </div>
        <button class="delete-button">å‰Šé™¤</button>
      `;
      postsDiv.appendChild(div);

      div.querySelectorAll(".reaction-button").forEach(btn=>{
        btn.addEventListener("click",()=>{
          const type=btn.getAttribute("data-type");
          p.reactions[type]++;
          db.ref("posts").child(p.id).set(p);
        });
      });

      div.querySelector(".delete-button").addEventListener("click",()=>{
        const currentUser=document.getElementById("name").value||"åç„¡ã—";
        if(currentUser===p.author){
          db.ref("posts").child(p.id).remove();
        }else{
          alert("è‡ªåˆ†ã®æŠ•ç¨¿ã—ã‹å‰Šé™¤ã§ãã¾ã›ã‚“");
        }
      });
    });
  }

  db.ref("posts").on("value",snapshot=>{
    renderPosts(snapshot.val());
  });

  form.addEventListener("submit",e=>{
    e.preventDefault();
    const name=document.getElementById("name").value||"åç„¡ã—";
    const icon=document.getElementById("icon").value||"usagi.png.jpeg";
    const comment=document.getElementById("comment").value.trim();
    if(!comment) return;
    const time=new Date().toLocaleString();
    const newPostRef=db.ref("posts").push();
    const id=newPostRef.key;
    newPostRef.set({
      id,
      author:name,
      name,
      icon,
      comment,
      time,
      reactions:{carrot:0,spark:0}
    });
    document.getElementById("comment").value="";
  });
</script>

</body>
</html>
