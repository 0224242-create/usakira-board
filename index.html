<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body{
  font-family:"Hiragino Kaku Gothic ProN",sans-serif;
  background:#fff0f8;
  padding:20px;
  color:#222;
}
body.dark{background:#121212;color:#eee}
h1{margin-bottom:10px}
.thread{
  border:2px solid #ffc6e6;
  background:#fff7fc;
  border-radius:14px;
  padding:10px;
  margin:10px 0;
}
body.dark .thread{background:#1b1b1b;border-color:#555}
a{color:#d22;text-decoration:none}
input,button{
  padding:6px;
  margin:4px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
button{cursor:pointer}
.meta{font-size:.75rem;color:#aa7}
</style>
</head>
<body>

<button id="darkToggle" style="position:fixed;right:12px;top:12px">ğŸŒ™</button>

<h1>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</h1>

<!-- ã‚¹ãƒ¬ä½œæˆ -->
<div>
  <input id="titleInput" placeholder="ã‚¹ãƒ¬ã‚¿ã‚¤ãƒˆãƒ«">
  <button id="createBtn">â• ã‚¹ãƒ¬ä½œæˆ</button>
</div>

<hr>

<!-- ã‚¹ãƒ¬ä¸€è¦§ -->
<div id="threadList"></div>

<script type="module">
import { initializeApp } from
 "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import {
  getDatabase, ref, onValue, push
} from
 "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  databaseURL:"https://keijiban-7c651-default-rtdb.firebaseio.com"
});
const db = getDatabase(app);

/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ */
const userId =
  localStorage.getItem("usakira_userId")
  || ("user_"+Math.random().toString(36).slice(2));
localStorage.setItem("usakira_userId",userId);

const userName =
  localStorage.getItem("usakira_name")
  || "åã‚‚ãªãå…";

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
const darkToggle=document.getElementById("darkToggle");
if(localStorage.getItem("usakira_dark")==="true"){
  document.body.classList.add("dark");
  darkToggle.textContent="â˜€ï¸";
}
darkToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem(
    "usakira_dark",
    document.body.classList.contains("dark")
  );
};

/* ã‚¹ãƒ¬ä½œæˆ */
createBtn.onclick=async()=>{
  const title=titleInput.value.trim();
  if(!title)return alert("ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥ã‚Œã¦ã­");
  await push(ref(db,"threads"),{
    title,
    ownerId:userId,
    ownerName:userName,
    time:Date.now()
  });
  titleInput.value="";
};

/* ã‚¹ãƒ¬ä¸€è¦§è¡¨ç¤º */
onValue(ref(db,"threads"), snap=>{
  threadList.innerHTML="";
  const data=snap.val();
  if(!data){
    threadList.textContent="ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“";
    return;
  }

  Object.entries(data)
    .sort((a,b)=>b[1].time-a[1].time)
    .forEach(([id,t])=>{
      const d=document.createElement("div");
      d.className="thread";
      d.innerHTML=`
        <a href="thread.html?id=${id}">
          <b>${t.title || "ç„¡é¡Œ"}</b>
        </a>
        <div class="meta">
          ${t.ownerName} ï½œ ${new Date(t.time).toLocaleString()}
        </div>
      `;
      threadList.appendChild(d);
    });
});
</script>

</body>
</html>
