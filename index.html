<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</title>
<style>
body { font-family: sans-serif; padding: 20px; }
textarea { width: 100%; height: 80px; }
.post { padding: 8px; border-bottom: 1px solid #ccc; margin: 6px 0; }
.owner { font-weight: bold; color: #d22; }
</style>
</head>
<body>
<h1>ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</h1>

<div id="banWarning" style="display:none;color:red;font-size:18px;font-weight:bold;margin-bottom:12px;">
ğŸš« ã‚ãªãŸã¯ç¾åœ¨BANä¸­ã®ãŸã‚æŠ•ç¨¿ã§ãã¾ã›ã‚“
</div>

<input id="nameInput" placeholder="åå‰ (ç©ºãªã‚‰ åã‚‚ãªãå…)" /><br><br>
<textarea id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea><br>
<button id="postButton">æŠ•ç¨¿</button>

<div id="posts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, push, set, onChildAdded, onValue } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const firebaseConfig = { ã“ã“ã«ã‚ãªãŸã®è¨­å®šãã®ã¾ã¾å…¥ã‚Œã¦OK };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥ç”¨ï¼ˆä»®IDï¼‰
let ownerId = localStorage.getItem("ownerId");
if (!ownerId) {
  ownerId = "user_" + Math.random().toString(36).slice(2);
  localStorage.setItem("ownerId", ownerId);
}

// BANãƒã‚§ãƒƒã‚¯
let isBanned = false;
onValue(ref(db, `bans/${ownerId}`), snap => {
  isBanned = !!snap.val();
  if (isBanned) {
    document.getElementById("banWarning").style.display = "block";
    document.getElementById("postButton").disabled = true;
  }
});

// æŠ•ç¨¿
document.getElementById("postButton").onclick = async () => {
  if (isBanned) return;
  const name = document.getElementById("nameInput").value.trim() || "åã‚‚ãªãå…";
  const msg = document.getElementById("messageInput").value.trim();
  if (!msg) return;

  await push(ref(db, "posts"), {
    name,
    msg,
    ownerId,
    time: Date.now()
  });

  document.getElementById("messageInput").value = "";
};

// æŠ•ç¨¿è¡¨ç¤º
onChildAdded(ref(db, "posts"), snap => {
  const p = snap.val();
  const div = document.createElement("div");
  div.className = "post";
  div.innerHTML = `<span class="owner">${p.name}</span>ï¼š${p.msg}`;
  document.getElementById("posts").prepend(div); // ä¸Šã«è¿½åŠ 
});
</script>
</body>
</html>
