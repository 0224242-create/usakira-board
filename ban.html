<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>BANç®¡ç†ï¼ˆç‰¢ç„ï¼‰</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body {
  font-family: "Hiragino Kaku Gothic ProN", sans-serif;
  background: #0b0b0b;
  color: #eaeaea;
  padding: 20px;
}
h1 { text-align:center; }
.cell {
  background: linear-gradient(#222, #111);
  border: 4px solid #555;
  border-radius: 12px;
  padding: 10px;
  margin: 10px 0;
}
.cell img {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  margin-right: 6px;
  vertical-align: middle;
}
button { padding: 6px 10px; margin: 4px; cursor: pointer; }
.empty { opacity: .7; margin-top: 20px; text-align:center; }
</style>
</head>
<body>
<h1>â›“ BANç®¡ç†ç‰¢ç„</h1>
<p style="text-align:center;margin-bottom:20px;">â€»ç®¡ç†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€Œmasterã€ã§æ“ä½œ</p>

<div id="banList">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, onValue, remove, get } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  authDomain: "keijiban-7c651.firebaseapp.com",
  databaseURL: "https://keijiban-7c651-default-rtdb.firebaseio.com",
  projectId: "keijiban-7c651",
  storageBucket: "keijiban-7c651.firebasestorage.app",
  messagingSenderId: "342192640264",
  appId: "1:342192640264:web:a004a725b470741aaf1cbd",
  measurementId: "G-7E1BZ3BGBR"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

onValue(ref(db, "bans"), async (snap) => {
  const box = document.getElementById("banList");
  const data = snap.val() || {};
  const ids = Object.keys(data);
  if (ids.length === 0) {
    box.innerHTML = `<div class="empty">ç¾åœ¨ã®åå®¹è€… 0å ğŸ•Š</div>`;
    return;
  }

  box.innerHTML = "";
  for (const uid of ids) {
    const threadsSnap = await get(ref(db, "threads"));
    let info = { ownerName: "???", ownerIcon: "usagi.png.jpeg" };

    if (threadsSnap.exists()) {
      const allThreads = threadsSnap.val();
      for (const tid in allThreads) {
        if (allThreads[tid].ownerId === uid) {
          info.ownerName = allThreads[tid].ownerName;
          info.ownerIcon = allThreads[tid].ownerIcon;
          break;
        }
      }
    }

    const div = document.createElement("div");
    div.className = "cell";
    div.innerHTML = `
      <img src="${info.ownerIcon}">
      <strong>${info.ownerName}</strong><br>
      <small>IDï¼š${uid}</small><br>
      <button data-id="${uid}" class="unbanBtn">è§£é™¤</button>
    `;
    box.appendChild(div);
  }

  document.querySelectorAll(".unbanBtn").forEach(btn => {
    btn.onclick = async () => {
      const pw = prompt("ç®¡ç†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰");
      if (pw !== "master") return alert("æ¨©é™ãªã—");
      const uid = btn.dataset.id;
      await remove(ref(db, `bans/${uid}`));
      alert("é‡ˆæ”¾ã—ãŸãƒšã‚³");
    };
  });
});
</script>
</body>
</html>
