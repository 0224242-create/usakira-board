<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ ç®¡ç†ãƒšãƒ¼ã‚¸âœ¨ï¸</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:"Hiragino Kaku Gothic ProN",sans-serif;background:#fff0f8;padding:20px;color:#222;transition:.25s;}
body.dark{background:#121212;color:#eee;}
.card{border:2px solid #ffc6e6;background:#fff7fc;border-radius:14px;padding:14px;}
body.dark .card{background:#1b1b1b;border-color:#555;}
.flex{display:flex;align-items:center;}
.flex-column{display:flex;flex-direction:column;}
.flex-end{display:flex;justify-content:flex-end;gap:6px;margin-top:8px;}
.icon{width:48px;height:48px;border-radius:50%;margin-right:10px;}
button{padding:4px 8px;border-radius:6px;cursor:pointer;}
#reportList,#banList{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
@media(max-width:800px){#reportList,#banList{grid-template-columns:1fr}}
</style>
</head>
<body>

<button id="darkToggle" style="position:fixed;right:12px;top:12px;">ğŸŒ™</button>
<h1>ğŸ° ç®¡ç†ãƒšãƒ¼ã‚¸</h1>

<h2>ğŸš¨ é€šå ±</h2>
<div id="reportList"></div>

<h2>ğŸš« BAN</h2>
<div id="banList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  databaseURL:"https://keijiban-7c651-default-rtdb.firebaseio.com"
});
const db = getDatabase(app);

/* ãƒ€ãƒ¼ã‚¯ */
const darkToggle=document.getElementById("darkToggle");
if(localStorage.getItem("usakira_dark")==="true"){
  document.body.classList.add("dark");
  darkToggle.textContent="â˜€ï¸";
}
darkToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("usakira_dark",document.body.classList.contains("dark"));
  darkToggle.textContent=document.body.classList.contains("dark")?"â˜€ï¸":"ğŸŒ™";
};

/* ğŸš¨ é€šå ± */
const reportList=document.getElementById("reportList");
onValue(ref(db,"reports"),snap=>{
  reportList.innerHTML="";
  Object.entries(snap.val()||{}).forEach(([rid,r])=>{
    const card=document.createElement("div");
    card.className="card flex-column";
    card.innerHTML=`
      <div class="flex">
        <img class="icon" src="${r.icon||'usagi.png.jpeg'}">
        <b>${r.name||"åã‚‚ãªãå…"}</b>
      </div>
      <p>${r.text}</p>
      <small>${new Date(r.time).toLocaleString()}</small>
      <div class="flex-end"></div>
    `;
    const tools=card.querySelector(".flex-end");

    const del=document.createElement("button");
    del.textContent="æŠ•ç¨¿å‰Šé™¤";
    del.onclick=async()=>{
      await set(ref(db,"posts/"+r.threadId+"/"+r.postId+"/deleted"),true);
      await remove(ref(db,"reports/"+rid));
    };

    const ban=document.createElement("button");
    ban.textContent="BAN";
    ban.onclick=async()=>{
      await set(ref(db,"bans/"+r.uid),{
        name:r.name,icon:r.icon,time:Date.now()
      });
      await remove(ref(db,"reports/"+rid));
    };

    tools.append(del,ban);
    reportList.appendChild(card);
  });
});

/* ğŸš« BAN */
const banList=document.getElementById("banList");
onValue(ref(db,"bans"),snap=>{
  banList.innerHTML="";
  Object.entries(snap.val()||{}).forEach(([uid,u])=>{
    const card=document.createElement("div");
    card.className="card flex";
    card.innerHTML=`
      <img class="icon" src="${u.icon}">
      <b>${u.name}</b>
    `;
    const un=document.createElement("button");
    un.textContent="è§£é™¤";
    un.onclick=()=>remove(ref(db,"bans/"+uid));
    card.appendChild(un);
    banList.appendChild(card);
  });
});
</script>
</body>
</html>
