<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ç®¡ç†ãƒšãƒ¼ã‚¸ - ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: "Hiragino Kaku Gothic ProN", sans-serif;
      background:#fff7fb;
      padding:20px;
      color:#222;
    }
    h1 { margin-bottom:20px; }
    .box {
      border:1px solid #ffbddd;
      padding:12px;
      margin-top:15px;
      background:#fff;
      border-radius:10px;
    }
    button {
      padding:6px 10px;
      margin:4px;
      border-radius:6px;
      cursor:pointer;
    }
  </style>
</head>
<body>

<h1>ğŸ° ç®¡ç†ãƒšãƒ¼ã‚¸ï¼ˆBAN & é€šå ±ãƒ­ã‚°ï¼‰</h1>

<div id="loginBox" class="box">
  <p>ç®¡ç†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
  <input id="pw" type="password" placeholder="ç®¡ç†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" />
  <button id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
</div>

<div id="adminArea" style="display:none">

  <h2>ğŸŸ¥ BANãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
  <div id="banList" class="box">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

  <h2>âš ï¸ é€šå ±ãƒ­ã‚°</h2>
  <div id="reportList" class="box">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  authDomain: "keijiban-7c651.firebaseapp.com",
  databaseURL: "https://keijiban-7c651-default-rtdb.firebaseio.com",
  projectId: "keijiban-7c651",
  storageBucket: "keijiban-7c651.firebasestorage.app",
  messagingSenderId: "342192640264",
  appId: "1:342192640264:web:a004a725b470741aaf1cbd",
  measurementId: "G-7E1BZ3BGBR"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ---------- ãƒ­ã‚°ã‚¤ãƒ³ ---------- */
document.getElementById("loginBtn").onclick = () => {
  const pw = document.getElementById("pw").value;
  if (pw === "master") {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminArea").style.display = "block";
  } else {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•ã„");
  }
};

/* ---------- BAN ä¸€è¦§ ---------- */
onValue(ref(db, "bans"), snap => {
  const data = snap.val() || {};
  const box = document.getElementById("banList");
  box.innerHTML = "";

  if (Object.keys(data).length === 0) {
    box.innerHTML = "BANãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚";
    return;
  }

  Object.keys(data).forEach(uid => {
    const div = document.createElement("div");
    div.innerHTML = `
      <strong>UID:</strong> ${uid}
      <button class="unbanBtn" data-uid="${uid}">è§£é™¤</button>
    `;
    box.appendChild(div);
  });

  document.querySelectorAll(".unbanBtn").forEach(btn => {
    btn.onclick = async () => {
      const uid = btn.dataset.uid;
      if (confirm("ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®BANã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ"))
        await remove(ref(db, "bans/" + uid));
    };
  });
});

/* ---------- é€šå ±ãƒ­ã‚° ---------- */
onValue(ref(db, "reports"), snap => {
  const data = snap.val() || {};
  const box = document.getElementById("reportList");
  box.innerHTML = "";

  if (Object.keys(data).length === 0) {
    box.innerHTML = "é€šå ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
    return;
  }

  Object.entries(data).forEach(([threadId, posts]) => {
    const tDiv = document.createElement("div");
    tDiv.innerHTML = `<h3>ã‚¹ãƒ¬ID: ${threadId}</h3>`;

    Object.entries(posts).forEach(([postId, users]) => {
      const count = Object.keys(users).length;

      const pDiv = document.createElement("div");
      pDiv.style.marginLeft = "20px";
      pDiv.innerHTML = `
        <p>
          æŠ•ç¨¿ID: ${postId}<br>
          é€šå ±æ•°: <strong>${count}</strong><br>
          <button class="delBtn"
                  data-thread="${threadId}"
                  data-post="${postId}">
            å‰Šé™¤
          </button>
        </p>
      `;
      tDiv.appendChild(pDiv);
    });

    box.appendChild(tDiv);
  });

  document.querySelectorAll(".delBtn").forEach(btn => {
    btn.onclick = async () => {
      const thread = btn.dataset.thread;
      const post = btn.dataset.post;

      if (!confirm("ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;

      await remove(ref(db, `posts/${thread}/${post}`));     // æŠ•ç¨¿å‰Šé™¤
      await remove(ref(db, `reports/${thread}/${post}`));   // é€šå ±ãƒ­ã‚°å‰Šé™¤

      alert("å‰Šé™¤ã—ã¾ã—ãŸ");
    };
  });
});
</script>

</body>
</html>
