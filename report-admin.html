<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ğŸš¨ é€šå ± | ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  font-family:"Hiragino Kaku Gothic ProN",sans-serif;
  background:#fff0f8;
  padding:20px;
  color:#222;
}
body.dark{background:#121212;color:#eee}

.card{
  border:2px solid #ffc6e6;
  background:#fff7fc;
  border-radius:14px;
  padding:14px;
  margin:12px 0;
}

button{
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}

textarea{
  width:100%;
  height:80px;
  border-radius:8px;
  padding:6px;
}
</style>
</head>

<body>

<h2>ğŸš¨ é€šå ±ãƒ•ã‚©ãƒ¼ãƒ </h2>
<a href="index.html">â† æ²ç¤ºæ¿ã«æˆ»ã‚‹</a>

<div class="card">
  <div id="info"></div>
  <textarea id="reason" placeholder="é€šå ±ç†ç”±ï¼ˆä»»æ„ï¼‰"></textarea>
  <button id="send">é€šå ±ã™ã‚‹</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, get, push } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

/* Firebase */
const app=initializeApp({
  apiKey:"AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  databaseURL:"https://keijiban-7c651-default-rtdb.firebaseio.com"
});
const db=getDatabase(app);

/* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */
const p=new URLSearchParams(location.search);
const threadId=p.get("thread");
const postId=p.get("post");

/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ */
const uid=localStorage.getItem("usakira_userId");
const name=localStorage.getItem("usakira_name")||"åã‚‚ãªãå…";
const icon=localStorage.getItem("usakira_icon")||"usagi.png.jpeg";

/* æƒ…å ±è¡¨ç¤º */
const info=document.getElementById("info");

(async()=>{
  const snap=await get(ref(db,`posts/${threadId}/${postId}`));
  if(!snap.exists()){
    info.textContent="æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
    return;
  }
  const p=snap.val();
  info.innerHTML=`
    <b>é€šå ±å¯¾è±¡</b><br>
    ${p.text}<br>
    <small>ID:${p.uid}</small>
  `;
})();

/* é€šå ±é€ä¿¡ */
document.getElementById("send").onclick=async()=>{
  const reason=document.getElementById("reason").value.trim();

  await push(ref(db,"reports"),{
    threadId,
    postId,
    userId: uid,
    name,
    icon,
    reason,
    time: Date.now()
  });

  alert("é€šå ±ã‚’é€ä¿¡ã—ãŸãƒšã‚³");
  location.href=`thread.html?id=${threadId}`;
};
</script>
</body>
</html>
