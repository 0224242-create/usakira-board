<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ ç®¡ç†ãƒšãƒ¼ã‚¸âœ¨ï¸</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    body {
      font-family:"Hiragino Kaku Gothic ProN", sans-serif;
      background:#fff0f8;
      padding:20px;
      color:#222;
      transition:0.25s;
    }
    body.dark { background:#121212; color:#eaeaea; }

    h1,h2 { margin-top:0; }

    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      border:2px solid #ffc6e6;
      background:#fff7fc;
      border-radius:14px;
      padding:14px;
      margin:0;
      box-shadow:0 2px 6px rgba(255,150,210,0.25);
      transition:0.2s;
    }
    .card:hover {
      transform:translateY(-3px);
      box-shadow:0 6px 12px rgba(255,150,210,0.32);
    }

    body.dark .card {
      background:#1b1b1b;
      border-color:#555;
      box-shadow:0 2px 6px rgba(0,0,0,0.35);
    }

    .card h3 a {
      color:#ff4fa8;
      text-decoration:none;
    }
    body.dark .card h3 a { color:#ff8cd1; }

    button {
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      border:1px solid #ccc;
      background:#fff;
    }
    body.dark button {
      background:#333;
      color:#eee;
      border-color:#666;
    }

    img.icon {
      width:48px;
      height:48px;
      border-radius:50%;
      object-fit:cover;
      border:2px solid #ffb8e6;
      margin-right:10px;
    }
    body.dark img.icon { border-color:#ff8cd1; }

    .flex { display:flex; align-items:center; }
    .flex-column { display:flex; flex-direction:column; }

    /* é€šå ±ãƒªã‚¹ãƒˆï¼š3åˆ—è¡¨ç¤º */
    #reportList {
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:14px;
    }
    @media(max-width:900px){
      #reportList { grid-template-columns:repeat(2,1fr); }
    }
    @media(max-width:600px){
      #reportList { grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
<button id="darkToggle" style="position:fixed;right:12px;top:12px;">ğŸŒ™</button>

<h1>ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ ç®¡ç†ãƒšãƒ¼ã‚¸âœ¨ï¸</h1>

<h2>é€šå ±ãƒªã‚¹ãƒˆ</h2>
<div id="reportList"></div>

<hr>

<h2>BANãƒªã‚¹ãƒˆ</h2>
<div id="banList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, onValue, get, set, remove } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  authDomain: "keijiban-7c651.firebaseapp.com",
  databaseURL: "https://keijiban-7c651-default-rtdb.firebaseio.com",
  projectId: "keijiban-7c651",
  storageBucket: "keijiban-7c651.firebasestorage.app",
  messagingSenderId: "342192640264",
  appId: "1:342192640264:web:a004a725b470741aaf1cbd"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
const darkToggle = document.getElementById("darkToggle");
const savedDark = localStorage.getItem("usakira_dark")==="true";
if(savedDark) document.body.classList.add("dark");
darkToggle.textContent = savedDark ? "â˜€ï¸" : "ğŸŒ™";
darkToggle.onclick = ()=>{
  const now = !document.body.classList.contains("dark");
  document.body.classList.toggle("dark");
  localStorage.setItem("usakira_dark", now);
  darkToggle.textContent = now ? "â˜€ï¸" : "ğŸŒ™";
};

/* é€šå ±ãƒªã‚¹ãƒˆ */
const reportList = document.getElementById("reportList");
onValue(ref(db,"reports"), async snap=>{
  reportList.innerHTML="";
  const reports = snap.val() || {};

  for(const threadId in reports){
    const threadSnap = await get(ref(db,`threads/${threadId}`));
    const thread = threadSnap.val();
    if(!thread) continue;

    for(const postId in reports[threadId]){
      const postSnap = await get(ref(db,`posts/${threadId}/${postId}`));
      const post = postSnap.val();
      if(!post) continue;

      const card = document.createElement("div");
      card.className="card flex-column";

      card.innerHTML = `
        <div class="flex">
          <img class="icon" src="${post.icon||'usagi.png.jpeg'}" onerror="this.src='usagi.png.jpeg'">
          <div>
            <h3><a href="thread.html?id=${threadId}">${thread.title||"ï¼ˆç„¡é¡Œï¼‰"}</a></h3>
            <div style="font-size:0.9rem;color:#888;">
              æŠ•ç¨¿è€…: ${post.name||"åã‚‚ãªãå…"} ${thread.pass?"ğŸ”’":""}
            </div>
          </div>
        </div>
        <p style="margin-top:8px;">${post.text||""}</p>
        <p style="font-size:0.85rem;color:#aa7;">
          é€šå ±æ•°: ${Object.keys(reports[threadId][postId]).length}
        </p>
      `;

      const btns = document.createElement("div");
      btns.style.display="flex";
      btns.style.justifyContent="flex-end";
      btns.style.gap="6px";

      /* å‰Šé™¤ */
      const delBtn=document.createElement("button");
      delBtn.textContent="å‰Šé™¤";
      delBtn.onclick=async()=>{
        if(!confirm("ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        await remove(ref(db,`posts/${threadId}/${postId}`));
        await remove(ref(db,`reports/${threadId}/${postId}`));
        alert("å‰Šé™¤ã—ãŸã‚ˆï¼");
      };

      /* BAN */
      const banBtn=document.createElement("button");
      banBtn.textContent="BAN";
      banBtn.onclick=async()=>{
        if(!confirm("ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’BANã—ã¾ã™ã‹ï¼Ÿ")) return;
        await set(ref(db,`bans/${post.uid}`),{
          name:post.name,
          icon:post.icon,
          time:Date.now()
        });
        alert("BANã—ãŸã‚ˆï¼");
      };

      /* é€šå ±è§£é™¤ */
      const clearBtn=document.createElement("button");
      clearBtn.textContent="é€šå ±è§£é™¤";
      clearBtn.onclick=async()=>{
        if(!confirm("é€šå ±ã‚’ã™ã¹ã¦è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        await remove(ref(db,`reports/${threadId}/${postId}`));
        alert("é€šå ±ã‚’è§£é™¤ã—ãŸã‚ˆï¼");
      };

      btns.append(delBtn, banBtn, clearBtn);
      card.appendChild(btns);
      reportList.appendChild(card);
    }
  }
});

/* BANãƒªã‚¹ãƒˆ */
const banList=document.getElementById("banList");
onValue(ref(db,"bans"), snap=>{
  banList.innerHTML="";
  const bans=snap.val()||{};

  for(const uid in bans){
    const u=bans[uid];
    const card=document.createElement("div");
    card.className="card flex";

    card.innerHTML=`
      <img class="icon" src="${u.icon||'usagi.png.jpeg'}" onerror="this.src='usagi.png.jpeg'">
      <div style="flex:1;margin-left:10px;">
        <h3>${u.name||"åã‚‚ãªãå…"}</h3>
        <p style="font-size:0.85rem;color:#aa7;">
          BANæ—¥æ™‚: ${new Date(u.time).toLocaleString()}
        </p>
      </div>
    `;

    const unbanBtn=document.createElement("button");
    unbanBtn.textContent="BANè§£é™¤";
    unbanBtn.onclick=async()=>{
      if(!confirm("æœ¬å½“ã«BANè§£é™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      await remove(ref(db,`bans/${uid}`));
      alert("è§£é™¤ã—ãŸã‚ˆï¼");
    };

    card.appendChild(unbanBtn);
    banList.appendChild(card);
  }
});
</script>
</body>
</html>
