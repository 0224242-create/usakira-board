<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ğŸ°ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ Import</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, get, onValue, set, remove } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

/* Firebase åˆæœŸåŒ– */
const firebaseConfig = {
  apiKey:"AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  databaseURL:"https://keijiban-7c651-default-rtdb.firebaseio.com"
};
const app = initializeApp(firebaseConfig);
export const db = getDatabase(app);

/* ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID */
export let uid = localStorage.getItem("usakira_userId");
if(!uid){
  uid="u_"+Math.random().toString(36).slice(2);
  localStorage.setItem("usakira_userId",uid);
}

/* åå‰ãƒ»ã‚¢ã‚¤ã‚³ãƒ³ */
export const name = localStorage.getItem("usakira_name")||"åã‚‚ãªãå…";
export const icon = localStorage.getItem("usakira_icon")||"usagi.png.jpeg";

/* BANãƒªã‚¹ãƒˆå–å¾— */
export let BAN_LIST = {};
onValue(ref(db,"ban"),snap=>{
  BAN_LIST = snap.val() || {};
  // BANã®å ´åˆãƒ­ã‚°è¡¨ç¤º
  if(BAN_LIST[uid]){
    console.log("ğŸš« BANä¸­ã§ã™", BAN_LIST[uid]);
  }
});

/* BANãƒã‚§ãƒƒã‚¯é–¢æ•° */
export async function checkBAN(userId){
  const snap = await get(ref(db,`ban/${userId}`));
  if(snap.exists()){
    return true;
  }
  return false;
}

/* BANç™»éŒ²é–¢æ•° */
export async function banUser(userId, userName, userIcon){
  await set(ref(db,`ban/${userId}`),{
    name:userName,
    icon:userIcon,
    time:Date.now()
  });
}

/* BANè§£é™¤é–¢æ•° */
export async function unbanUser(userId){
  await remove(ref(db,`ban/${userId}`));
}

/* æŠ•ç¨¿ã§ãã‚‹ã‹åˆ¤å®š */
export function canPost(){
  return !BAN_LIST[uid];
}
</script>
</body>
</html>
