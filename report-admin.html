<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ ç®¡ç†ãƒšãƒ¼ã‚¸âœ¨ï¸</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{
  font-family:"Hiragino Kaku Gothic ProN",sans-serif;
  background:#fff0f8;
  padding:20px;
  color:#222;
  transition:0.25s;
}
body.dark{background:#121212;color:#eee;}

h1,h2{margin-top:0;}

.card{
  border:2px solid #ffc6e6;
  background:#fff7fc;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 2px 6px rgba(255,150,210,.25);
}
body.dark .card{background:#1b1b1b;border-color:#555;}

.flex{display:flex;align-items:center;}
.flex-column{display:flex;flex-direction:column;}
.flex-end{display:flex;justify-content:flex-end;gap:6px;margin-top:8px;}

.icon{
  width:48px;height:48px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #ffb8e6;
  margin-right:10px;
}

button{padding:6px 10px;border-radius:6px;cursor:pointer;}

#reportList,#banList{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}
@media(max-width:900px){#reportList,#banList{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){#reportList,#banList{grid-template-columns:1fr}}
</style>
</head>
<body>

<button id="darkToggle" style="position:fixed;right:12px;top:12px">ğŸŒ™</button>

<h1>ğŸ° ã†ã•â˜…ã‚­ãƒ©æ²ç¤ºæ¿ ç®¡ç†ãƒšãƒ¼ã‚¸âœ¨ï¸</h1>

<h2>ğŸš¨ é€šå ±ãƒªã‚¹ãƒˆ</h2>
<div id="reportList"></div>

<hr>

<h2>ğŸš« BANãƒªã‚¹ãƒˆ</h2>
<div id="banList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
import { getDatabase, ref, onValue, set, remove, get } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

/* Firebase */
const firebaseConfig = {
  apiKey:"AIzaSyDwp6403Wctjo-2vjR373CjfJXDDGUp7do",
  databaseURL:"https://keijiban-7c651-default-rtdb.firebaseio.com"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ç®¡ç†è€…ãƒ•ãƒ©ã‚° */
localStorage.setItem("usakira_admin","true");

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
const darkToggle=document.getElementById("darkToggle");
const savedDark=localStorage.getItem("usakira_dark")==="true";
if(savedDark) document.body.classList.add("dark");
darkToggle.textContent=savedDark?"â˜€ï¸":"ğŸŒ™";
darkToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  const now=document.body.classList.contains("dark");
  localStorage.setItem("usakira_dark",now);
  darkToggle.textContent=now?"â˜€ï¸":"ğŸŒ™";
};

/* é€šå ±ãƒªã‚¹ãƒˆè¡¨ç¤º */
const reportList=document.getElementById("reportList");

onValue(ref(db,"reports"),async snap=>{
  reportList.innerHTML="";
  const reports=snap.val()||{};

  for(const threadId in reports){
    const threadSnap=await get(ref(db,`threads/${threadId}`));
    const thread=threadSnap.val();
    if(!thread) continue;

    for(const postId in reports[threadId]){
      const postSnap=await get(ref(db,`posts/${threadId}/${postId}`));
      const post=postSnap.val();
      if(!post) continue;

      const card=document.createElement("div");
      card.className="card flex-column";
      card.innerHTML=`
        <div class="flex">
          <img class="icon" src="${post.ownerIcon||'usagi.png.jpeg'}" onerror="this.src='usagi.png.jpeg'">
          <div>
            <h3><a href="thread.html?id=${threadId}">${thread.title||"ï¼ˆç„¡é¡Œï¼‰"}</a></h3>
            <div style="font-size:0.85rem;color:#888;">
              æŠ•ç¨¿è€…: ${post.ownerName||"åã‚‚ãªãå…"} ${thread.pass?"ğŸ”’":""}
            </div>
          </div>
        </div>
        <p style="margin:8px 0">${post.body||""}</p>
        <div style="font-size:0.8rem;color:#aa7">
          é€šå ±æ•°: ${Object.keys(reports[threadId][postId]).length}
        </div>
      `;

      const tools=document.createElement("div");
      tools.className="flex-end";

      // å‰Šé™¤
      const del=document.createElement("button");
      del.textContent="å‰Šé™¤";
      del.onclick=async()=>{
        if(!confirm("ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        await remove(ref(db,`posts/${threadId}/${postId}`));
        await remove(ref(db,`reports/${threadId}/${postId}`));
        alert("å‰Šé™¤ã—ãŸãƒšã‚³");
      };

      // BAN
      const ban=document.createElement("button");
      ban.textContent="BAN";
      ban.onclick=async()=>{
        if(!confirm("ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’BANã—ã¾ã™ã‹ï¼Ÿ")) return;
        await set(ref(db,`bans/${post.ownerId}`),{
          name:post.ownerName,
          icon:post.ownerIcon,
          time:Date.now()
        });
        alert("BANã—ãŸãƒšã‚³");
      };

      // é€šå ±è§£é™¤
      const clear=document.createElement("button");
      clear.textContent="é€šå ±è§£é™¤";
      clear.onclick=async()=>{
        if(!confirm("é€šå ±ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        await remove(ref(db,`reports/${threadId}/${postId}`));
        alert("è§£é™¤ã—ãŸãƒšã‚³");
      };

      tools.append(del,ban,clear);
      card.appendChild(tools);
      reportList.appendChild(card);
    }
  }
});

/* BANãƒªã‚¹ãƒˆè¡¨ç¤º */
const banList=document.getElementById("banList");

onValue(ref(db,"bans"),snap=>{
  banList.innerHTML="";
  const bans=snap.val()||{};
  for(const uid in bans){
    const u=bans[uid];
    const card=document.createElement("div");
    card.className="card flex";
    card.innerHTML=`
      <img class="icon" src="${u.icon||'usagi.png.jpeg'}" onerror="this.src='usagi.png.jpeg'">
      <div style="flex:1;margin-left:10px;">
        <h3>${u.name||"åã‚‚ãªãå…"}</h3>
        <p style="font-size:0.85rem;color:#aa7;">BANæ—¥æ™‚: ${new Date(u.time).toLocaleString()}</p>
      </div>
    `;
    const unban=document.createElement("button");
    unban.textContent="BANè§£é™¤";
    unban.onclick=async()=>{
      if(!confirm("BANè§£é™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      await remove(ref(db,`bans/${uid}`));
      alert("è§£é™¤ã—ãŸãƒšã‚³");
    };
    card.appendChild(unban);
    banList.appendChild(card);
  }
});
</script>

</body>
</html>
